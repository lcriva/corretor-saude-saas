generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  senha         String
  nome          String
  telefone      String?
  plano         String   @default("free")
  criadoEm      DateTime @default(now())
  atualizadoEm  DateTime @updatedAt
  
  leads         Lead[]
  propostas     Proposta[]
  
  @@map("users")
}

model Lead {
  id            String   @id @default(uuid())
  nome          String?
  email         String?
  telefone      String
  idade         Int?
  cidade        String?
  estado        String?
  dependentes   Int      @default(0)
  status        String   @default("novo")
  origem        String   @default("whatsapp")
  valorEstimado Float?
  valorPlano    Float?   // Novo campo
  planoDesejado String?  // Novo campo
  idadesDependentes Json? // Novo campo: Array de idades ex: [5, 12]
  scoreIA       Float?
  percentualConclusao Int @default(0)
  observacoes   String?
  lastFollowUpAt DateTime?
  followUpCount Int      @default(0)
  
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  interacoes    Interacao[]
  propostas     Proposta[]
  
  criadoEm      DateTime @default(now())
  atualizadoEm  DateTime @updatedAt
  
  @@map("leads")
  @@index([userId])
  @@index([status])
}

model Interacao {
  id          String   @id @default(uuid())
  tipo        String
  descricao   String
  
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  criadoEm    DateTime @default(now())
  
  @@map("interacoes")
  @@index([leadId])
}

model Proposta {
  id          String   @id @default(uuid())
  operadora   String
  plano       String
  valor       Float
  cobertura   String?
  enviada     Boolean  @default(false)
  aceita      Boolean  @default(false)
  
  leadId      String
  lead        Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  criadoEm    DateTime @default(now())
  
  @@map("propostas")
  @@index([leadId])
  @@index([userId])
}

model Plano {
  id          String   @id @default(uuid())
  operadora   String
  nome        String
  tipo        String
  cobertura   String
  precoBase   Float
  ativo       Boolean  @default(true)
  
  criadoEm    DateTime @default(now())
  atualizadoEm DateTime @updatedAt
  
  @@map("planos")
  @@index([operadora])
  @@index([ativo])
}